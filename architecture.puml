@startuml
!theme cerulean
skinparam componentStyle rectangle

package "API Layer" {
  [Express REST API] as Express
  [Apollo GraphQL API] as Apollo
  [Node.js API Server] as APIServer

  Express --> APIServer
  Apollo --> APIServer
}

package "Ongoing Indexing Layer" {
  [Node.js Worker (Live Indexer)] as LiveWorker
  [node-cron Scheduler] as Cron
  [PostgreSQL + TimescaleDB] as Postgres

  [Moralis API] as Moralis
  [CoinMarketCap API] as CMC
  [The Graph API] as TheGraph
  [Orca API] as Orca

  [pino (logger)] as Pino
  [Logtail (collector)] as Logtail

  Cron --> LiveWorker : schedules jobs
  LiveWorker --> Moralis : fetches live data
  LiveWorker --> CMC : fetches market data
  LiveWorker --> TheGraph : fetches subgraph data
  LiveWorker --> Orca : fetches DEX data
  LiveWorker --> Postgres : writes time-series

  LiveWorker --> Pino : structured logs
  Pino --> Logtail : ships logs
}

Postgres --> APIServer : read aggregated data

package "Frontend Layer" {
  [Frontend Client] as FrontendClient
  FrontendClient --> Apollo : GraphQL queries
  FrontendClient --> Express : REST calls
}

package "CI/CD + Hosting" {
  [GitHub Actions] as GitHub
  [Docker Containers] as Docker
  [Render.com] as Render
  [Better Stack (Email Alerts)] as BetterStack

  GitHub --> Docker : builds image
  Docker --> Render : deploys container

  ' Show that Logtail sends email alerts via Better Stack
  Logtail --> BetterStack : email alerts
}

@enduml
